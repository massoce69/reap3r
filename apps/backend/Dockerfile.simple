FROM node:20-alpine

WORKDIR /app

# Copy root package files
COPY package.json package-lock.json* ./
COPY tsconfig.base.json ./

# Copy packages
COPY packages ./packages
COPY apps/backend ./apps/backend

# Install all dependencies
RUN npm install --workspace=apps/backend --workspace=packages/shared --include-workspace-root

# Expose port
EXPOSE 4000

# Run in dev mode with tsx
WORKDIR /app/apps/backend
CMD ["npx", "tsx", "watch", "src/index.ts"]